version: "3.9"

services:
  main:
    build: ./chat_main
    container_name: chat_main
    ports:
      - "8010:8010"
    environment:
      - PROCESSOR_URL=http://processor:8001
    depends_on:
      - processor
    volumes:
      - ./chat_main:/app
    restart: unless-stopped

  processor:
    build: ./chat_processor
    container_name: chat_processor
    ports:
      - "8011:8011"
    volumes:
      - ./chat_processor:/app
    restart: unless-stopped

  auth_reg:
    build: ./auth_reg
    container_name: auth_reg
    ports:
      - "8009:8009"
    volumes:
      - ./auth_reg:/app
    restart: unless-stopped

  video_webcam:
    build: ./video_webcam
    container_name: video_webcam
    ports:
      - "8008:8008"
    volumes:
      - ./video_webcam:/app
    restart: unless-stopped

  janus:
    build: ./janus
    container_name: janus
    restart: always
    ports:
      - "8188:8188"           # WebSocket
      - "8088:8088"           # HTTP API (опционально)
      - "20000-40000:20000-40000/udp"  # RTP потоки
    networks:
      - janus_net

  frontend:
    image: nginx:alpine
    container_name: janus_frontend
    restart: always
    volumes:
      - ./janus/frontend:/usr/share/nginx/html
    ports:
      - "8015:80"
    depends_on:
      - janus
    networks:
      - janus_net

networks:
  janus_net:
    driver: bridge
